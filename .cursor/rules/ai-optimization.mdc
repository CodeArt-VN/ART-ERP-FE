---
description: "AI Optimization Rules - Tá»‘i Æ°u hÃ³a hiá»‡u quáº£ sá»­ dá»¥ng AI, tiáº¿t kiá»‡m chi phÃ­ vÃ  request"
globs: ["**/*"]
alwaysApply: true
---

# AI Optimization Rules - Tá»‘i Æ°u hÃ³a hiá»‡u quáº£ sá»­ dá»¥ng AI

## ğŸ¯ **Má»¥c Ä‘Ã­ch**
Tá»‘i Æ°u hÃ³a hiá»‡u quáº£ sá»­ dá»¥ng AI, tiáº¿t kiá»‡m chi phÃ­ vÃ  giáº£m thiá»ƒu sá»‘ lÆ°á»£ng request khÃ´ng cáº§n thiáº¿t.

## ğŸ“Š **PhÃ¢n tÃ­ch váº¥n Ä‘á» hiá»‡n táº¡i**

### **1. Váº¥n Ä‘á» Ä‘á»c file nhiá»u láº§n**
- **Hiá»‡n táº¡i**: Äá»c cÃ¹ng 1 file 4-5 láº§n trong 1 session
- **NguyÃªn nhÃ¢n**: KhÃ´ng cache, khÃ´ng batch reading
- **Giáº£i phÃ¡p**: Implement file caching vÃ  parallel reading

### **2. Request khÃ´ng hiá»‡u quáº£**
- **Hiá»‡n táº¡i**: Nhiá»u request nhá» thay vÃ¬ 1 request lá»›n
- **NguyÃªn nhÃ¢n**: KhÃ´ng group operations
- **Giáº£i phÃ¡p**: Batch processing vÃ  CLI operations

## ğŸš€ **Quy táº¯c tá»‘i Æ°u hÃ³a**

### **1. File Reading Optimization**

#### **âœ… ÄÃºng - Batch File Reading**
```typescript
// Äá»c nhiá»u file cÃ¹ng lÃºc
const files = await Promise.all([
  read_file('file1.ts'),
  read_file('file2.ts'), 
  read_file('file3.ts')
]);
```

#### **âœ… ÄÃºng - File Caching**
```typescript
// Cache file content Ä‘á»ƒ trÃ¡nh Ä‘á»c láº¡i
const fileCache = new Map();
if (!fileCache.has(filePath)) {
  fileCache.set(filePath, await read_file(filePath));
}
```

#### **âŒ Sai - Äá»c file nhiá»u láº§n**
```typescript
// KhÃ´ng nÃªn Ä‘á»c cÃ¹ng 1 file nhiá»u láº§n
const content1 = await read_file('file.ts');
const content2 = await read_file('file.ts'); // Äá»c láº¡i khÃ´ng cáº§n thiáº¿t
```

### **2. Batch Operations**

#### **âœ… ÄÃºng - MultiEdit cho nhiá»u thay Ä‘á»•i**
```typescript
// Sá»­ dá»¥ng MultiEdit thay vÃ¬ nhiá»u search_replace
MultiEdit(file_path, [
  { old_string: 'old1', new_string: 'new1' },
  { old_string: 'old2', new_string: 'new2' },
  { old_string: 'old3', new_string: 'new3' }
]);
```

#### **âœ… ÄÃºng - CLI cho bulk operations**
```bash
# Sá»­ dá»¥ng CLI cho thay tháº¿ hÃ ng loáº¡t
find . -name "*.ts" -exec sed -i 's/oldPattern/newPattern/g' {} +
```

#### **âŒ Sai - Nhiá»u request riÃªng láº»**
```typescript
// KhÃ´ng nÃªn lÃ m nhiá»u request riÃªng láº»
search_replace(file, 'old1', 'new1');
search_replace(file, 'old2', 'new2'); 
search_replace(file, 'old3', 'new3');
```

### **3. Tool Usage Optimization**

#### **âœ… ÄÃºng - Parallel Tool Calls**
```typescript
// Gá»i nhiá»u tool cÃ¹ng lÃºc
const [result1, result2, result3] = await Promise.all([
  codebase_search(query1, dirs1),
  codebase_search(query2, dirs2),
  grep(pattern, path)
]);
```

#### **âœ… ÄÃºng - Efficient Search Patterns**
```typescript
// Sá»­ dá»¥ng grep cho exact matches
grep('exactPattern', path, { output_mode: 'files_with_matches' });

// Sá»­ dá»¥ng codebase_search cho semantic search
codebase_search('How does authentication work?', ['auth/']);
```

#### **âŒ Sai - Sequential tool calls**
```typescript
// KhÃ´ng nÃªn gá»i tool tuáº§n tá»± khi cÃ³ thá»ƒ parallel
const result1 = await codebase_search(query1);
const result2 = await codebase_search(query2);
const result3 = await grep(pattern);
```

### **4. Request Batching**

#### **âœ… ÄÃºng - Group Related Operations**
```typescript
// NhÃ³m cÃ¡c operations liÃªn quan
const todos = [
  { id: 'task1', content: 'Implement feature A', status: 'pending' },
  { id: 'task2', content: 'Fix bug B', status: 'pending' },
  { id: 'task3', content: 'Optimize C', status: 'pending' }
];
todo_write(false, todos);
```

#### **âœ… ÄÃºng - Single Comprehensive Request**
```
Thay vÃ¬:
- "TÃ¬m táº¥t cáº£ file .ts"
- "Äá»c file A"  
- "Äá»c file B"
- "Sá»­a file A"
- "Sá»­a file B"

NÃªn lÃ m:
- "TÃ¬m vÃ  sá»­a táº¥t cáº£ file .ts theo pattern X"
```

## ğŸ’° **Tiáº¿t kiá»‡m chi phÃ­**

### **1. Token Usage Optimization**

#### **âœ… ÄÃºng - Concise Prompts**
```
// Ngáº¯n gá»n, rÃµ rÃ ng
"Refactor UserService to use dependency injection"

// Thay vÃ¬ dÃ i dÃ²ng
"Please help me refactor the UserService class that is currently located in the services directory to implement proper dependency injection pattern following Angular best practices..."
```

#### **âœ… ÄÃºng - Context Reuse**
```
// Sá»­ dá»¥ng láº¡i context tá»« previous messages
"Apply the same pattern to OrderService"
```

#### **âŒ Sai - Redundant Information**
```
// KhÃ´ng láº·p láº¡i thÃ´ng tin Ä‘Ã£ biáº¿t
"Please refactor the UserService class that we just discussed and that is in the services folder..."
```

### **2. Efficient Code Generation**

#### **âœ… ÄÃºng - Template-based Generation**
```typescript
// Sá»­ dá»¥ng template cÃ³ sáºµn
const template = `
export class {{className}} {
  constructor(private env: EnvService) {}
  
  async {{methodName}}() {
    // Implementation
  }
}`;
```

#### **âœ… ÄÃºng - Incremental Development**
```
// PhÃ¡t triá»ƒn tá»«ng bÆ°á»›c
1. "Create basic structure"
2. "Add validation logic" 
3. "Add error handling"
```

## ğŸ› ï¸ **CLI Operations cho Bulk Processing**

### **1. File Operations**
```bash
# TÃ¬m vÃ  thay tháº¿ hÃ ng loáº¡t
find . -name "*.ts" -type f -exec sed -i 's/oldPattern/newPattern/g' {} +

# Äá»•i tÃªn file hÃ ng loáº¡t
find . -name "*.component.ts" -exec rename 's/component/comp/g' {} +

# XÃ³a file hÃ ng loáº¡t
find . -name "*.spec.ts" -delete
```

### **2. Code Analysis**
```bash
# Äáº¿m sá»‘ lÆ°á»£ng function
grep -r "function\|=>" --include="*.ts" . | wc -l

# TÃ¬m unused imports
grep -r "import.*from" --include="*.ts" . | sort | uniq -c | sort -nr
```

### **3. Batch Refactoring**
```bash
# Thay tháº¿ táº¥t cáº£ console.log thÃ nh dog && console.log
find . -name "*.ts" -exec sed -i 's/console\.log(/dog \&\& console.log(/g' {} +

# ThÃªm import EnvService
find . -name "*.ts" -exec sed -i '1i import { EnvService } from "../services/env.service";' {} +
```

## ğŸ“‹ **Best Practices Checklist**

### **TrÆ°á»›c khi gá»­i request:**
- [ ] ÄÃ£ group cÃ¡c operations liÃªn quan?
- [ ] ÄÃ£ sá»­ dá»¥ng parallel tool calls?
- [ ] ÄÃ£ cache file content?
- [ ] CÃ³ thá»ƒ dÃ¹ng CLI thay vÃ¬ multiple requests?

### **Khi viáº¿t prompt:**
- [ ] Prompt ngáº¯n gá»n, rÃµ rÃ ng?
- [ ] KhÃ´ng láº·p láº¡i thÃ´ng tin Ä‘Ã£ biáº¿t?
- [ ] ÄÃ£ specify Ä‘áº§y Ä‘á»§ requirements?
- [ ] CÃ³ thá»ƒ reuse context tá»« previous messages?

### **Khi implement:**
- [ ] Sá»­ dá»¥ng MultiEdit cho multiple changes?
- [ ] Batch related operations?
- [ ] Cache file reads?
- [ ] Use efficient search patterns?

## ğŸ¯ **Káº¿t quáº£ mong Ä‘á»£i**

### **1. Giáº£m sá»‘ lÆ°á»£ng request**
- Tá»« 10 requests â†’ 3-4 requests cho cÃ¹ng 1 task
- Batch operations thay vÃ¬ individual operations

### **2. TÄƒng hiá»‡u quáº£**
- Parallel processing
- File caching
- CLI automation

### **3. Tiáº¿t kiá»‡m chi phÃ­**
- Giáº£m 60-70% token usage
- Giáº£m 50-60% sá»‘ lÆ°á»£ng requests
- TÄƒng 2-3x tá»‘c Ä‘á»™ xá»­ lÃ½

## ğŸš¨ **LÆ°u Ã½ quan trá»ng**

- **LuÃ´n Æ°u tiÃªn batch operations** thay vÃ¬ individual operations
- **Sá»­ dá»¥ng CLI** cho bulk processing
- **Cache file content** Ä‘á»ƒ trÃ¡nh Ä‘á»c láº¡i
- **Group related tasks** trong 1 request
- **Sá»­ dá»¥ng parallel tool calls** khi cÃ³ thá»ƒ
- **Viáº¿t prompt ngáº¯n gá»n** nhÆ°ng Ä‘áº§y Ä‘á»§ thÃ´ng tin
- **LUÃ”N LÃŠN Káº¾ HOáº CH TRÆ¯á»šC KHI CODE** - KhÃ´ng bao giá» code ngay mÃ  khÃ´ng cÃ³ káº¿ hoáº¡ch chi tiáº¿t
- **Confirm káº¿ hoáº¡ch vá»›i user** trÆ°á»›c khi báº¯t Ä‘áº§u implement
- **TÃ¡ch biá»‡t planning vÃ  implementation** - KhÃ´ng mix láº«n hai giai Ä‘oáº¡n nÃ y