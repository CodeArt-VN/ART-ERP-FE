<ion-header>
	<ion-toolbar>
		<ion-title>{{ 'Amount due' | translate }}: {{item.DebtAmount | number: '1.0-0' }} đ</ion-title>
		<ion-buttons slot="primary">
			<!-- <ion-button title="{{ 'Refresh' | translate }}" color="primary" (click)="refresh()">
				<ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
			</ion-button> -->
			<ion-button title="{{ 'Close' | translate }}" color="secondary" (click)="closeModal()">
				<ion-icon slot="icon-only" name="close"></ion-icon>
			</ion-button>
		</ion-buttons>
	</ion-toolbar>
</ion-header>
<ion-content *ngIf="!payment" appScrollbarTheme>
	<div class="one-col ">

		<div class="main-view">

			<div class="row-full shadow">

			</div>
			<form *ngIf="formGroup" [formGroup]="formGroup">
				<div class="row-full shadow">
					<ion-card-header>
						<ion-card-subtitle [color]="item.IsRefundTransaction ? 'danger' : ''">
							<span *ngIf="item.IsRefundTransaction">
								{{ 'Refund type' | translate }}
							</span>
							<span *ngIf="!item.IsRefundTransaction">
								{{ 'Payment type' | translate }}
							</span>
						</ion-card-subtitle>
					</ion-card-header>
					<ion-list>

						<!-- Chỉ hiển thị nếu IsActiveTypeCash = true -->
						<div *ngIf="item.IsActiveTypeCash">
							<!-- ========== TIỀN MẶT ========== -->
							<ion-item button (click)="changeSubType(null)">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="Cash" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="Type">
								</div>
								<ion-icon name="cash-outline" slot="start"></ion-icon>
								<ion-label>{{ 'Cash' | translate }}</ion-label>

								<!-- <ion-radio slot="end" [checked]="paymentType` === 'cash'"></ion-radio> -->
							</ion-item>

							<!-- ========== CÔNG NỢ ========== -->
							<ion-item button (click)="changeSubType(null)">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="Debt" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="Type">
								</div>
								<ion-icon name="cash-outline" slot="start"></ion-icon>
								<ion-label>{{ 'Debt' | translate }}</ion-label>
							</ion-item>

							<!-- ========== BOD ========== -->
							<ion-item button (click)="changeSubType(null)">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="BOD" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="Type">
								</div>
								<ion-icon name="cash-outline" slot="start"></ion-icon>
								<ion-label>BOD</ion-label>
							</ion-item>

							<!-- ========== CHUYỂN KHOẢN ========== -->
							<ion-item button (click)="changeSubType(null)">
								<div slot="start" style="margin-top:6px">
									<input type="radio" value="Transfer" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="Type">
								</div>
								<ion-icon name="wallet-outline" slot="start"></ion-icon>
								<ion-label class="ion-text-wrap"><span>{{ 'Transfer' | translate }}</span>
									<fieldset *ngIf="formGroup.get('Type').value === 'Transfer'" id="bank-transfer">
										<ion-grid>
											<ion-row>
												<ion-col size="auto" *ngFor="let bank of bankList"
													style="flex: 0 0 auto; width: auto;">
													<input type="radio" [value]="bank.Code"
														class="c-checkbox PaymentType" [id]="bank.Code"
														formControlName="SubType" (click)="$event.stopPropagation()">
													<label class="list-group-item" [for]="bank.Code"
														(click)="$event.stopPropagation()">
														<span><img style="border:1px solid #ccc" height="50px"
																[src]="bank.Image" /></span>
													</label>
												</ion-col>
											</ion-row>
										</ion-grid>
									</fieldset>

								</ion-label>


							</ion-item>

							<!-- Hiển thị danh sách ngân hàng khi chọn chuyển khoản -->

							<!-- ========== CÀ THẺ ========== -->
							<ion-item button (click)="changeSubType(null)">
								<div slot="start" style="margin-top:6px">
									<input type="radio" value="Card" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="Type">
								</div>
								<ion-icon name="card-outline" slot="start"></ion-icon>
								<ion-label class="ion-text-wrap">
									<span>{{ 'Card' | translate }}</span>
									<fieldset id="bank-transfer" *ngIf="formGroup.get('Type').value=='Card'">
										<ion-grid>
											<ion-row *ngIf="!edccList?.length">
												<ion-col size="auto">
													{{'Not found payment terminal'| translate}}
												</ion-col>
											</ion-row>
											<ion-row *ngIf="edccList?.length>0">
												<ion-col size="auto" *ngFor="let edcc of edccList"
													style="flex: 0 0 auto; width: auto;">
													<input type="radio" [value]="edcc.REF_ID"
														(change)="changeEDCC($event)" class="c-checkbox PaymentType"
														[id]="edcc.REF_ID" formControlName="EDCC"
														(click)="$event.stopPropagation()">
													<label class="list-group-item" [for]="edcc.REF_ID"
														(click)="$event.stopPropagation()">
														<span><img style="border:1px solid #ccc" height="50px"
																src="/assets/logos/banks/EDCC.jpg" /></span>
														{{edcc.Bank}}
													</label>
												</ion-col>
											</ion-row>
										</ion-grid>
									</fieldset>
								</ion-label>
							</ion-item>

						</div>

						<!-- Hiển thị nếu ZaloPay đang được kích hoạt -->
						<div>

							<!-- ========== APPLE PAY ========== -->
							<!-- <ion-item button (click)="changeType('ZalopayApp')">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="ApplePay" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="SubType">
								</div>
								<img src="/assets/logos/banks/applepay.svg" alt="Apple Pay" style="width: 1.6em;"
									slot="start" />
								<ion-label>
									<span class="payment-text">{{ 'Apple Pay' | translate }}</span>
								</ion-label>
							</ion-item> -->

							<!-- ========== ZALOPAY APP ========== -->
							<ion-item button (click)="changeType('ZalopayApp')">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="Wallet" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="SubType">
								</div>
								<img src="/assets/logos/banks/zalopay.ico" style="width: 1.6em;" slot="start" />
								<ion-label>
									<span>{{ 'Thanh toán bằng ví ZaloPay' | translate }}</span>
								</ion-label>

							</ion-item>
							<!--
							<ion-item button (click)="changeType('ZalopayApp')">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="ATM" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="SubType">
								</div>
								<img src="/assets/logos/banks/zalopay.ico" style="width: 1.6em;" slot="start" />
								<ion-label style="display:flex; align-items:center;">
									<span>{{ 'Thẻ ATM' | translate }}</span>
									<small>({{ 'Qua cổng ZaloPay' | translate }})</small>
								</ion-label>
							</ion-item>

							<ion-item button (click)="changeType('ZalopayApp')">
								<div slot="start" class="ion-align-self-start" style="margin-top:6px">
									<input type="radio" value="Visa" class="c-checkbox PaymentType"
										id="listGroupRadioGrid4" formControlName="SubType">
								</div>
								<img src="/assets/logos/banks/zalopay.ico" style="width: 1.6em;" slot="start" />
								<ion-label style="display:flex; align-items:center;">
									<span>{{ 'Thẻ Visa' | translate }}</span>
									<small>({{ 'Qua cổng ZaloPay' | translate }})</small>
								</ion-label>
								<ion-radio slot="end" [checked]="paymentType === 'zalopaycc'"></ion-radio>
							</ion-item> -->

						</div>


					</ion-list>
					<ion-card-content>

						<!-- Gợi ý mệnh giá -->
						<div id="gr-btn-amount"
							*ngIf="!item.IsRefundTransaction && this.formGroup.get('Type').value === 'Cash'"
							style="text-align: right; margin-bottom: 16px;">
							<ion-button *ngFor="let amount of btnAmounts" class="btn-amount" fill="outline" size="small"
								(click)="selectAmount(amount)">
								{{ amount | number: '1.0-0' }} đ
							</ion-button>
						</div>

						<!-- Ô nhập số tiền -->
						<div class="c-control inline-control">
							<label class="c-label" for="currency-field">
								<span *ngIf="item.IsRefundTransaction; else amountLabel">
									{{ 'Refund amount' | translate }}
								</span>
								<ng-template #amountLabel>
									{{ 'Payment amount' | translate }}
								</ng-template>
							</label>
							<input class="c-input" mask="separator.2" thousandSeparator=","
								[allowNegativeNumbers]="false" suffix=" ₫" formControlName="InputAmount"
								[ngModelOptions]="{standalone: true}" type="text">
							<!-- <input id="currency-field" type="text" placeholder="{{ 'Nhập số tiền' | translate }}"
							class="c-input input-money" formControlName="InputAmount" /> -->
						</div>

						<!-- Tiền thừa -->
						<div class="c-control inline-control" id="form-thechange" *ngIf="!item.IsRefundTransaction">
							<label class="c-label" for="currency-thechange">
								{{ 'Tiền thừa' | translate }}
							</label>
							<input readonly id="currency-thechange" class="c-input input-money"
								[value]="changeAmount | number: '1.0-0'" />
						</div>

						<!-- Ghi chú hoặc lý do hoàn tiền -->
						<div class="c-control inline-control" *ngIf="item.IsActiveZlpay || item.IsActiveTypeCash">
							<label class="c-label" for="Remark">
								<span *ngIf="item.IsRefundTransaction; else remarkLabel">
									{{ 'Refund reason' | translate }}
								</span>
								<ng-template #remarkLabel>
									{{ 'Remark' | translate }}
								</ng-template>
							</label>
							<input type="text" id="Remark" class="c-input remark"
								placeholder="{{ 'Remark' | translate }}" formControlName="Remark" />
						</div>

						<!-- Thông báo bảo mật -->
						<div class="c-control">
							<ion-note>
								<div class="ion-text-center">
									<small>
										<ion-icon name="shield-checkmark"></ion-icon>
										{{ 'SSL/TLS security certificate' | translate }}<br />
										{{ 'All transaction information is securely encrypted' | translate }}.
									</small>
								</div>
							</ion-note>
						</div>

						<!-- Nút xác nhận hoặc cảnh báo bảo trì -->
						<!-- <div class="c-control">
							<div *ngIf="!item.IsActiveZlpay && !item.IsActiveTypeCash; else confirmButton">
								<div class="text-center">
									<span class="text-danger">{{ 'Payment function is under maintenance.' | translate
										}}</span>
									<div>
										<span class="text-danger">
											{{ 'Please contact with the staff for assistance' | translate }}
										</span>
									</div>
								</div>
							</div>
					
						</div> -->


					</ion-card-content>
				</div>



			</form>

		</div>

	</div>
</ion-content>
<ion-content *ngIf="payment">
	<div class="one-col ">
		<div class="main-view">

			<div class="row-full shadow">
				<ion-card-header>
					<ion-card-title class="ion-text-center" *ngIf="payment.Status != 'Processing'"
						[color]="payment?._Status.Color">{{'Payment'|translate}}
						{{payment?.Status |
						translate | lowercase }}</ion-card-title>
					<ion-card-title class="ion-text-center" *ngIf="payment.Status == 'Processing'"
						[color]="payment?._Status.Color">{{'Awaiting payment'|translate}}
					</ion-card-title>
				</ion-card-header>


				<ion-list>
					<ion-item>
						<ion-label><span>{{'Branch'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary">{{item.BranchName}}</ion-note>
					</ion-item>
					<ion-item>
						<ion-label><span>{{'Sale order'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary">#{{item.IDSaleOrder}}</ion-note>
					</ion-item>
					<ion-item *ngIf="payment.IsRefundTransaction">
						<ion-label><span>{{'Original Transaction'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary">#{{payment.IDOriginalTransaction}}</ion-note>
					</ion-item>



					<ion-item>
						<ion-label><span>{{'Payment code'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary">{{payment.CreatedDate|date
							:'yyMMdd'}}_{{payment.Id}}</ion-note>
					</ion-item>
					<ion-item>
						<ion-label><span>{{'Payment type'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary">{{payment.Type | translate}} </ion-note>
						<ion-note slot="end" color="primary">{{payment.SubType | translate}}</ion-note>

					</ion-item>
					<ion-item>
						<ion-label><span>{{'Created date'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary">{{payment.CreatedDate | date:'HH:mm
							dd/MM/yyyy'}}</ion-note>
					</ion-item>

					<ion-item lines="none">
						<ion-label>
							<span>{{'Amount'|translate}}</span></ion-label>
						<ion-note slot="end" color="primary"><b>{{payment.Amount | number:'1.0-0'}}
								<sup>đ</sup></b></ion-note>
					</ion-item>
				</ion-list>


				<ion-card-content>


					<div class="c-control">
						<ion-note>
							<div class="ion-text-center">
								<small>
									<ion-icon name="shield-checkmark"></ion-icon>
									<span>{{'SSL/TLS security certificate'|translate}}</span><br />
									<span>{{'All transaction information is securely
										encrypted'|translate}}</span>.
								</small>
							</div>
						</ion-note>

					</div>
					<ion-note color="warning">
						{{announmentText|translate}}
					</ion-note>
				</ion-card-content>
			</div>
		</div>

	</div>
</ion-content>
<ion-footer>
	<ion-toolbar>
		<!-- <ion-buttons slot="start">
			<ion-button *ngIf="payment && payment.Status == 'Processing'" expand="block" fill="solid" color="success"
				(click)="checkResult()">
				<ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
				{{ 'Check result' | translate }}
			</ion-button>
		</ion-buttons> -->

		<ion-buttons slot="end">
			<ion-button *ngIf="payment && payment.Status == 'Fail'" expand="block" fill="solid" color="success"
				(click)="confirmPayment()">
				<ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
				{{ 'Back' | translate }}
			</ion-button>
			<ion-button
				[disabled]="submitAttempt || (formGroup.get('Type').value == 'Transfer' && !formGroup.get('SubType').value) "
				*ngIf="formGroup.get('Type').value != 'Card' && !payment" expand="block" fill="solid" color="success"
				(click)="confirmPayment()">
				<ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
				{{ 'Confirm' | translate }}
			</ion-button>
			<ion-button [disabled]="submitAttempt || !formGroup.get('EDCC').value"
				*ngIf="formGroup.get('Type').value == 'Card' && !payment" expand="block" fill="solid" color="success"
				(click)="postSale()">
				<ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
				{{ 'Create payment' | translate }}
			</ion-button>
			<ion-button type="submit" fill="solid" expand="block" id="btn_close" (click)="closeModal()">
				<ion-icon slot="start" name="close"></ion-icon>
				<span>{{'Close'|translate}}</span>
			</ion-button>
		</ion-buttons>

	</ion-toolbar>
</ion-footer>