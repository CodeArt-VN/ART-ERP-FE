<ion-header>
  <app-toolbar [page]="this"></app-toolbar>
</ion-header>
<ion-content appScrollbarTheme class="left" [ngClass]="{withFeature: pageConfig.isShowFeature}" forceOverscroll="false">
  <!-- <ion-refresher [disabled]="!pageConfig.refresher" slot="fixed" (ionRefresh)="refresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher> -->

  <ion-fab
    *ngIf="pageConfig.isShowFeature"
    [ngClass]="{'ion-hide-md-down' : pageConfig.isSubActive}"
    class="feature no-print"
    vertical="bottom"
    horizontal="start"
    slot="fixed"
  >
    <ion-list>
      <ion-list-header lines="full">
        <ion-label color="dark">{{'Providers' | translate}}</ion-label>
      </ion-list-header>
      <ion-item [color]="!groupControl.selectedGroup? 'primary': '' " lines="full" button (click)="onGroupChange(null)">
        <ion-icon aria-hidden="true" name="layers" slot="start"></ion-icon>
        <ion-label>{{'All' | translate}}</ion-label>
      </ion-item>
      <ion-reorder-group [disabled]="!groupControl.showReorder" (ionItemReorder)="handleReorder($any($event))">
        <ion-item
          [color]="g.Id == groupControl.selectedGroup?.Id? 'primary': '' "
          lines="full"
          button
          *ngFor="let g of groupControl.groupList"
          (click)="onGroupChange(g)"
        >
          <ion-img
            slot="start"
            class="icon-30"
            #img
            [src]="g.Icon"
            (ionError)="img.src = 'assets/avartar-empty.jpg'"
          ></ion-img>
          <ion-label [title]="g.Id">{{g.Name | translate}}</ion-label>
          <ion-reorder slot="end"></ion-reorder>
        </ion-item>
      </ion-reorder-group>
    </ion-list>
  </ion-fab>

  <div style="max-width: 1440px; margin: auto; width: 100%; position: sticky; left: 0" class="ion-padding">
    <app-page-title [pageConfig]="pageConfig"></app-page-title>
  </div>

  <div style="max-width: 1440px; margin: auto; width: 100%">
    <app-data-table
      style="width: fit-content; min-width: calc(100% - 32px)"
      class="box-shadow responsive"
      [rows]="itemsState"
      [trackBy]="'Id'"
      [isTreeList]="true"
      [(selectedRows)]="selectedItems"
      [showSpinner]="pageConfig.showSpinner"
      [showFilter]="pageConfig.isShowSearch"
      [(query)]="query"
      (dataInfinite)="loadData($event)"
      (filter)="onDatatableFilter($event)"
      (sort)="onSort($event)"
    >
      <datatable-column [checkbox]="true" name=""></datatable-column>
      <datatable-column class="col-id" name="#" property="Id"></datatable-column>
      <!-- <datatable-column class="col-icon large" name="" property="Id">
        <ng-template let-i="row" datatable-cell-template>
          <ion-icon
            [name]="i.Icon || 'flash'"
            [color]="i.Color || 'primary'"
            [routerLink]="['/'+pageConfig.pageName+'/'+i.Id]"
          ></ion-icon>
        </ng-template>
      </datatable-column> -->

      <datatable-column class="col-name" name="Name" property="Name">
        <ng-template datatable-header-template>
          <ion-icon
            class="min-btn"
            [name]="!isAllRowOpened? 'add-circle-outline':'remove-circle-outline'"
            (click)="toggleRowAll()"
          ></ion-icon>
          <span (click)="toggleRowAll()">{{'Name' | translate}}</span>
        </ng-template>
        <ng-template let-i="row" datatable-cell-template>
          <ng-container *ngFor="let w of i.levels; let k = index;"
            ><span class="spacing" *ngIf="k>0"></span
          ></ng-container>
          <ion-icon
            (click)="toggleRow(items, i, true);"
            class="min-btn clickable"
            [name]="!i.showdetail? 'chevron-forward-outline':'chevron-down-outline'"
            *ngIf="i.HasChild"
          ></ion-icon>
          <ion-icon class="min-btn clickable" [name]="''" *ngIf="!i.HasChild"></ion-icon>
          <ion-icon class="min-btn" [name]="i.Icon || 'flash'"></ion-icon>
          <ion-text
            class="clickable"
            [ngClass]="i.HasChild? ('bold ') : ('')"
            [color]="i.Color"
            [routerLink]="['/'+pageConfig.pageName+'/'+i.Id]"
            >{{i.Name}}</ion-text
          >
        </ng-template>
      </datatable-column>
      <datatable-column class="col-code" name="Method" property="Method"></datatable-column>

      <!-- <datatable-column class="col-name" name="Name" property="Name">
        <ng-template let-i="row" datatable-cell-template>
          <div [routerLink]="['/'+pageConfig.pageName+'/'+i.Id]">
            <a class="bold">
              <ion-text color="dark">{{i.Name}}</ion-text>
              <small *ngIf="i.IsTriggerable">{{'Triggerable'}}</small>
            </a>
            <div *ngIf="i.Remark">{{i.Remark}}</div>
          </div>
        </ng-template>
      </datatable-column> -->
    </app-data-table>
  </div>

  <div class="ion-padding"></div>
  <!-- <ion-infinite-scroll
    color="primary"
    threshold="30%"
    (ionInfinite)="loadData($event)"
    [disabled]="!pageConfig.infiniteScroll || pageConfig.isEndOfData"
  >
    <ion-infinite-scroll-content loadingSpinner="dots"></ion-infinite-scroll-content>
  </ion-infinite-scroll> -->
</ion-content>
